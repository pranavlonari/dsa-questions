<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sum of Total Strength of Wizards - DSA Solutions</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        line-height: 1.8;
        color: #333;
        background: #f5f7fa;
      }

      /* Header Navigation */
      .top-nav {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .nav-brand {
        font-size: 1.3em;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .nav-brand a {
        color: white;
        text-decoration: none;
      }

      .nav-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .nav-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 6px;
        text-decoration: none;
      }

      .nav-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .nav-btn.primary {
        background: white;
        color: #667eea;
        font-weight: 600;
      }

      .nav-btn.primary:hover {
        background: #f8f9fa;
      }

      /* Main Container */
      .container {
        max-width: 1200px;
        margin: 30px auto;
        padding: 0 20px;
      }

      /* Question Navigation */
      .question-nav {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 25px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .nav-group {
        display: flex;
        gap: 10px;
      }

      .question-btn {
        padding: 12px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
        color: white;
        text-decoration: none;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
      }

      .question-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);
      }

      .question-btn:disabled {
        background: #e0e0e0;
        color: #999;
        cursor: not-allowed;
        box-shadow: none;
      }

      .question-btn span {
        font-size: 16px;
      }

      /* Search Bar */
      .search-container {
        position: relative;
        flex: 1;
        min-width: 250px;
        max-width: 400px;
      }

      .search-input {
        width: 100%;
        padding: 10px 40px 10px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s;
      }

      .search-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .search-icon {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #999;
      }

      /* Question Header */
      .question-header {
        background: white;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 25px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .question-title {
        font-size: 2em;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 15px;
      }

      .question-meta {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        align-items: center;
      }

      .difficulty-badge {
        padding: 6px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
      }

      .difficulty-easy {
        background: #d4edda;
        color: #155724;
      }

      .difficulty-medium {
        background: #fff3cd;
        color: #856404;
      }

      .difficulty-hard {
        background: #f8d7da;
        color: #721c24;
      }

      .topic-tag {
        background: #e7f3ff;
        color: #0066cc;
        padding: 6px 14px;
        border-radius: 16px;
        font-size: 13px;
        font-weight: 500;
      }

      /* Action Buttons */
      .action-buttons {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 25px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .action-btn {
        padding: 10px 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .action-btn.secondary {
        background: white;
        color: #667eea;
        border: 2px solid #667eea;
      }

      .action-btn.secondary:hover {
        background: #f8f9fa;
      }

      /* Content Area */
      .content-wrapper {
        background: white;
        border-radius: 12px;
        padding: 40px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        margin-bottom: 25px;
        line-height: 1.9;
      }

      .content-wrapper h1,
      .content-wrapper h2,
      .content-wrapper h3 {
        color: #2c3e50;
        margin-top: 35px;
        margin-bottom: 18px;
        padding-bottom: 12px;
        border-bottom: 3px solid #667eea;
        font-weight: 700;
      }

      .content-wrapper h1 {
        font-size: 2em;
        color: #667eea;
      }

      .content-wrapper h2 {
        font-size: 1.6em;
        border-bottom: 2px solid #764ba2;
      }

      .content-wrapper h3 {
        font-size: 1.35em;
        border-bottom: 2px solid #e0e0e0;
      }

      .content-wrapper h1:first-child,
      .content-wrapper h2:first-child,
      .content-wrapper h3:first-child {
        margin-top: 0;
      }

      .content-wrapper p {
        margin-bottom: 18px;
        color: #444;
        font-size: 16px;
      }

      .content-wrapper ul,
      .content-wrapper ol {
        margin-left: 30px;
        margin-bottom: 20px;
      }

      .content-wrapper li {
        margin-bottom: 10px;
        color: #555;
        line-height: 1.8;
      }

      .content-wrapper strong {
        color: #2c3e50;
        font-weight: 600;
      }

      .content-wrapper em {
        color: #667eea;
      }

      /* Code Blocks */
      .content-wrapper pre {
        background: #2d2d2d;
        border: 1px solid #444;
        border-radius: 10px;
        padding: 24px;
        overflow-x: auto;
        margin: 25px 0;
        position: relative;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .content-wrapper code {
        font-family: "Consolas", "Monaco", "Courier New", Courier, monospace;
        font-size: 14px;
        line-height: 1.7;
        color: #f8f8f2;
      }

      .content-wrapper p code,
      .content-wrapper li code {
        background: #fff4e6;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.9em;
        border: 1px solid #ffe0b2;
        color: #d84315;
        font-weight: 500;
      }

      /* Copy Button for Code */
      .code-block {
        position: relative;
      }

      .copy-code-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 6px 12px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        opacity: 0.8;
        transition: all 0.3s;
      }

      .copy-code-btn:hover {
        opacity: 1;
      }

      .copy-code-btn.copied {
        background: #28a745;
      }

      /* Toast Notification */
      .toast {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: #28a745;
        color: white;
        padding: 15px 25px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transform: translateY(100px);
        opacity: 0;
        transition: all 0.3s;
        z-index: 2000;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .toast.show {
        transform: translateY(0);
        opacity: 1;
      }

      /* Footer */
      footer {
        background: white;
        border-radius: 12px;
        padding: 25px;
        text-align: center;
        color: #666;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        margin-top: 30px;
      }

      footer a {
        color: #667eea;
        text-decoration: none;
        font-weight: 600;
      }

      footer a:hover {
        text-decoration: underline;
      }

      /* Tablet Responsive */
      @media (max-width: 1024px) {
        .container {
          margin: 20px 10px;
        }

        h1 {
          font-size: 2em;
        }

        .content-wrapper {
          padding: 25px;
        }
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        .container {
          margin: 0;
          border-radius: 15px;
        }

        .top-nav {
          padding: 12px 0;
        }

        .nav-container {
          flex-direction: column;
          align-items: flex-start;
          padding: 0 15px;
        }

        .nav-brand {
          font-size: 1.1em;
        }

        .nav-actions {
          width: 100%;
          justify-content: stretch;
        }

        .nav-btn {
          flex: 1;
          justify-content: center;
          font-size: 13px;
          padding: 7px 12px;
        }

        header {
          padding: 30px 20px;
        }

        h1 {
          font-size: 1.8em;
        }

        .stats {
          gap: 10px;
        }

        .stat-item {
          padding: 8px 15px;
          min-width: 80px;
        }

        .stat-number {
          font-size: 1.5em;
        }

        .question-nav {
          flex-direction: column;
          align-items: stretch;
          padding: 15px;
          gap: 10px;
        }

        .nav-group {
          justify-content: space-between;
          width: 100%;
        }

        .question-btn {
          flex: 1;
          padding: 10px 15px;
          font-size: 13px;
        }

        .search-container {
          max-width: 100%;
          order: -1;
        }

        .search-input {
          font-size: 15px;
        }

        .question-header {
          padding: 20px;
        }

        .question-title {
          font-size: 1.4em;
          line-height: 1.3;
        }

        .question-meta {
          gap: 10px;
        }

        .difficulty-badge {
          padding: 5px 12px;
          font-size: 13px;
        }

        .topic-tag {
          padding: 5px 10px;
          font-size: 12px;
        }

        .action-buttons {
          flex-direction: column;
          padding: 15px;
        }

        .action-btn {
          width: 100%;
          justify-content: center;
          padding: 12px 20px;
        }

        .content-wrapper {
          padding: 20px 15px;
        }

        .content-wrapper h1 {
          font-size: 1.5em;
        }

        .content-wrapper h2 {
          font-size: 1.3em;
        }

        .content-wrapper h3 {
          font-size: 1.15em;
        }

        .content-wrapper pre {
          padding: 15px;
          font-size: 13px;
          overflow-x: auto;
        }

        .copy-code-btn {
          font-size: 11px;
          padding: 5px 10px;
        }

        .toast {
          right: 10px;
          left: 10px;
          bottom: 10px;
          padding: 12px 20px;
          font-size: 14px;
        }

        footer {
          padding: 20px 15px;
          font-size: 14px;
        }
      }

      /* Small Mobile */
      @media (max-width: 480px) {
        .nav-brand {
          font-size: 1em;
        }

        h1 {
          font-size: 1.5em;
        }

        .question-title {
          font-size: 1.2em;
        }

        .question-btn {
          padding: 8px 10px;
          font-size: 12px;
        }

        .question-btn span {
          display: none;
        }

        .action-btn {
          font-size: 13px;
          padding: 10px 15px;
        }

        .stat-item {
          padding: 6px 10px;
          font-size: 13px;
        }

        .content-wrapper {
          padding: 15px 10px;
        }

        .content-wrapper pre {
          padding: 12px;
          font-size: 12px;
        }
      }

      /* Loading Animation */
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Print Styles */
      @media print {
        .top-nav,
        .question-nav,
        .action-buttons,
        .toast {
          display: none;
        }

        .container {
          max-width: 100%;
          margin: 0;
          padding: 0;
        }

        .content-wrapper {
          box-shadow: none;
          padding: 0;
        }
      }
    </style>
  </head>
  <body>
    <!-- Top Navigation -->
    <nav class="top-nav">
      <div class="nav-container">
        <div class="nav-brand">
          <span>üöÄ</span>
          <a href="index.html">DSA Questions</a>
        </div>
        <div class="nav-actions">
          <a href="index.html" class="nav-btn primary">
            <span>üìö</span> All Questions
          </a>
          <button onclick="toggleTheme()" class="nav-btn">
            <span id="theme-icon">üåô</span> Theme
          </button>
        </div>
      </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
      <!-- Question Navigation -->
      <div class="question-nav">
        <div class="nav-group">
          <button class="question-btn" id="prevBtn" onclick="navigateToPrev()">
            <span>‚Üê</span> Previous
          </button>
          <button class="question-btn" id="nextBtn" onclick="navigateToNext()">
            Next <span>‚Üí</span>
          </button>
        </div>
        <div class="search-container">
          <input
            type="text"
            class="search-input"
            id="searchInput"
            placeholder="Search questions..."
          />
          <span class="search-icon">üîç</span>
        </div>
        <div class="nav-group">
          <button class="question-btn" onclick="showRandomQuestion()">
            <span>üé≤</span> Random
          </button>
        </div>
      </div>

      <!-- Question Header -->
      <div class="question-header">
        <h1 class="question-title" id="questionTitle">Sum of Total Strength of Wizards</h1>
        <div class="question-meta" id="questionMeta">
          <span class="difficulty-badge difficulty-medium"
            >Medium</span
          >
          <span class="topic-tag">Array</span><span class="topic-tag">String</span><span class="topic-tag">Two Pointers</span><span class="topic-tag">Stack</span><span class="topic-tag">Queue</span>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="action-btn" onclick="copyContent()">
          <span>üìã</span> Copy All
        </button>
        <button class="action-btn" onclick="copyCode()">
          <span>üíª</span> Copy Code
        </button>
        <button class="action-btn secondary" onclick="exportToPDF()">
          <span>üìÑ</span> Export PDF
        </button>
        <button class="action-btn secondary" onclick="exportToMarkdown()">
          <span>üìù</span> Export MD
        </button>
        <button class="action-btn secondary" onclick="shareQuestion()">
          <span>üîó</span> Share
        </button>
      </div>

      <!-- Question Content -->
      <div class="content-wrapper" id="questionContent"><p>Sum of Total Strength of Wizards</p>

<p>As the ruler of a kingdom, you have an army of wizards at your command.</p>

<p>You are given a 0-indexed integer array strength, where strength[i] denotes the strength of the ith wizard. For a contiguous group of wizards (i.e. the wizards' strengths form a subarray of strength), the total strength is defined as the product of the following two values:</p>

<p>The strength of the weakest wizard in the group.
The total of all the individual strengths of the wizards in the group.
Return the sum of the total strengths of all contiguous groups of wizards. Since the answer may be very large, return it modulo 109 + 7.</p>

<p>A subarray is a contiguous non-empty sequence of elements within an array.</p>

<p>Example 1:</p>

<p>Input: strength = [1,3,1,2]
Output: 44
Explanation: The following are all the contiguous groups of wizards:</p>

<ul>
<li>[1] from [1,3,1,2] has a total strength of min([1]) _ sum([1]) = 1 _ 1 = 1</li>
<li>[3] from [1,3,1,2] has a total strength of min([3]) _ sum([3]) = 3 _ 3 = 9</li>
<li>[1] from [1,3,1,2] has a total strength of min([1]) _ sum([1]) = 1 _ 1 = 1</li>
<li>[2] from [1,3,1,2] has a total strength of min([2]) _ sum([2]) = 2 _ 2 = 4</li>
<li>[1,3] from [1,3,1,2] has a total strength of min([1,3]) _ sum([1,3]) = 1 _ 4 = 4</li>
<li>[3,1] from [1,3,1,2] has a total strength of min([3,1]) _ sum([3,1]) = 1 _ 4 = 4</li>
<li>[1,2] from [1,3,1,2] has a total strength of min([1,2]) _ sum([1,2]) = 1 _ 3 = 3</li>
<li>[1,3,1] from [1,3,1,2] has a total strength of min([1,3,1]) _ sum([1,3,1]) = 1 _ 5 = 5</li>
<li>[3,1,2] from [1,3,1,2] has a total strength of min([3,1,2]) _ sum([3,1,2]) = 1 _ 6 = 6</li>
<li>[1,3,1,2] from [1,3,1,2] has a total strength of min([1,3,1,2]) _ sum([1,3,1,2]) = 1 _ 7 = 7</li>
</ul>
  The sum of all the total strengths is 1 + 9 + 1 + 4 + 4 + 4 + 3 + 5 + 6 + 7 = 44.
  Example 2:

<p>Input: strength = [5,4,6]
Output: 213
Explanation: The following are all the contiguous groups of wizards:</p>

<ul>
<li>[5] from [5,4,6] has a total strength of min([5]) _ sum([5]) = 5 _ 5 = 25</li>
<li>[4] from [5,4,6] has a total strength of min([4]) _ sum([4]) = 4 _ 4 = 16</li>
<li>[6] from [5,4,6] has a total strength of min([6]) _ sum([6]) = 6 _ 6 = 36</li>
<li>[5,4] from [5,4,6] has a total strength of min([5,4]) _ sum([5,4]) = 4 _ 9 = 36</li>
<li>[4,6] from [5,4,6] has a total strength of min([4,6]) _ sum([4,6]) = 4 _ 10 = 40</li>
<li>[5,4,6] from [5,4,6] has a total strength of min([5,4,6]) _ sum([5,4,6]) = 4 _ 15 = 60</li>
</ul>
  The sum of all the total strengths is 25 + 16 + 36 + 36 + 40 + 60 = 213.

<p>Constraints:</p>

<p>1 <= strength.length <= 10^5
1 <= strength[i] <= 10^9</p>

<h2>Problem recap (one line)</h2>

<p>For every contiguous subarray, its contribution = <code>(minimum element) * (sum of elements in that subarray)</code>. Sum these contributions over <strong>all</strong> subarrays and return result mod <code>1e9+7</code>.</p>

<p>---</p>

<h2>Key idea / reduction</h2>

<p>Fix an index <code>i</code>; count all subarrays where <code>A[i]</code> is the minimum of the subarray. For those subarrays, the total contribution from those subarrays equals:</p>

<p><pre><code>A[i] * (sum of sums of all subarrays in which A[i] is the minimum)</code></pre></p>

<p>So if we can enumerate for each <code>i</code>:</p>

<ul>
<li>the range of starts <code>s</code> and ends <code>e</code> such that subarray <code>[s..e]</code> contains <code>i</code> and <code>A[i]</code> is the minimum,</li>
<li>and compute the <strong>sum of all subarray sums</strong> for those <code>(s,e)</code> quickly,</li>
</ul>

<p>we can add up contributions for all <code>i</code>.</p>

<p>---</p>

<h2>How to determine ranges where A[i] is the minimum</h2>

<p>Define:</p>

<ul>
<li><code>prevLess[i]</code> = index of previous element strictly less than <code>A[i]</code> (0 if none).</li>
<li><code>nextLessEqual[i]</code> = index of next element <strong>less than or equal to</strong> <code>A[i]</code> (n+1 if none).</li>
</ul>

<p>Then any subarray with start <code>s</code> in <code>(prevLess[i] + 1 .. i)</code> and end <code>e</code> in <code>(i .. nextLessEqual[i] - 1)</code> will have <code>A[i]</code> as the (first) minimum of the subarray (this choice of strict < on left and ‚â§ on right avoids double counting ties). Let:</p>

<ul>
<li><code>L = i - prevLess[i]</code> (number of choices for start),</li>
<li><code>R = nextLessEqual[i] - i</code> (number of choices for end).</li>
</ul>

<p>---</p>

<h2>How to compute sum of sums for those subarrays</h2>

<p>Let <code>pref[k] = sum_{1..k} A[j]</code> (prefix sums, 1-based, <code>pref[0] = 0</code>), and
let <code>pref2[k] = sum_{1..k} pref[j]</code> (prefix-of-prefix sums, <code>pref2[0] = 0</code>).</p>

<p>We want</p>

<p><pre><code>S = sum_{s = prev+1..i} sum_{e = i..next-1} sum_{t = s..e} A[t]
  = sum_{s} sum_{e} (pref[e] - pref[s-1])
  = (i - prev) * (pref2[next-1] - pref2[i-1])   -   (next - i) * (pref2[i-1] - pref2[prev])</code></pre></p>

<p>Therefore contribution of index <code>i</code>:</p>

<p><pre><code>contrib[i] = A[i] * S</code></pre></p>

<p>Sum <code>contrib[i]</code> for all <code>i</code> and take modulo.</p>

<p>---</p>

<h2>How to find prevLess and nextLessEqual in O(n)</h2>

<p>Use monotonic stacks:</p>

<ul>
<li>For <code>prevLess</code>: scan <code>i = 1..n</code>, while <code>stack</code> not empty and <code>A[stack.peek()] >= A[i]</code> pop; then <code>prevLess[i] = stack.isEmpty() ? 0 : stack.peek(); push(i)</code>.</li>
<li>For <code>nextLessEqual</code>: scan <code>i = n..1</code>, while <code>stack</code> not empty and <code>A[stack.peek()] > A[i]</code> pop; then <code>nextLessEqual[i] = stack.isEmpty() ? n+1 : stack.peek(); push(i)</code>.</li>
</ul>

<p>This gets the strict on left and non-strict on right tie handling.</p>

<p>---</p>

<h2>Complexity</h2>

<ul>
<li>Time: O(n) (each index pushed/popped at most once; a few linear scans).</li>
<li>Space: O(n) extra arrays & stacks.</li>
<li>All arithmetic on 64-bit and modulo <code>1_000_000_007</code>.</li>
</ul>

<p>---</p>

<h2>Java implementation</h2>

<p><pre><code>import java.util.*;

public class TotalStrength {
    private static final long MOD = 1_000_000_007L;

    public int totalStrength(int[] strength) {
        int n = strength.length;
        long[] A = new long[n + 1]; // 1-based
        for (int i = 1; i <= n; i++) A[i] = strength[i - 1];

        // prefix sums and prefix-of-prefix sums (1-based)
        long[] pref = new long[n + 1];
        long[] pref2 = new long[n + 1];
        for (int i = 1; i <= n; i++) {
            pref[i] = (pref[i - 1] + A[i]) % MOD;
            pref2[i] = (pref2[i - 1] + pref[i]) % MOD;
        }

        // prevLess (strict): previous index j with A[j] < A[i], or 0
        int[] prevLess = new int[n + 1];
        Deque<Integer> stack = new ArrayDeque<>();
        for (int i = 1; i <= n; i++) {
            while (!stack.isEmpty() && A[stack.peek()] >= A[i]) stack.pop();
            prevLess[i] = stack.isEmpty() ? 0 : stack.peek();
            stack.push(i);
        }

        // nextLessEqual (non-strict): next index j with A[j] <= A[i], or n+1
        int[] nextLessEqual = new int[n + 1];
        stack.clear();
        for (int i = n; i >= 1; i--) {
            while (!stack.isEmpty() && A[stack.peek()] > A[i]) stack.pop();
            nextLessEqual[i] = stack.isEmpty() ? n + 1 : stack.peek();
            stack.push(i);
        }

        long ans = 0L;
        for (int i = 1; i <= n; i++) {
            int L = i - prevLess[i];
            int R = nextLessEqual[i] - i;

            // S = L * (pref2[r-1] - pref2[i-1]) - R * (pref2[i-1] - pref2[prev])
            long part1 = (pref2[nextLessEqual[i] - 1] - pref2[i - 1]) % MOD;
            if (part1 < 0) part1 += MOD;
            long part2 = (pref2[i - 1] - pref2[prevLess[i]]) % MOD;
            if (part2 < 0) part2 += MOD;

            long S = ( (part1 * L) % MOD - (part2 * R) % MOD ) % MOD;
            if (S < 0) S += MOD;

            long contrib = (A[i] % MOD) * S % MOD;
            ans += contrib;
            ans %= MOD;
        }

        return (int) ans;
    }

    // quick manual tests
    public static void main(String[] args) {
        TotalStrength solver = new TotalStrength();

        System.out.println(solver.totalStrength(new int[]{1,3,1,2})); // expected 44
        System.out.println(solver.totalStrength(new int[]{5,4,6}));   // expected 213
        // Additional tests
        System.out.println(solver.totalStrength(new int[]{1}));       // 1
        System.out.println(solver.totalStrength(new int[]{1,1,1}));   // small check
    }
}</code></pre></p>

<p>---</p>

<h2>Notes / pitfalls</h2>

<ul>
<li>Use strict <code><</code> on left and <code><=</code> on right to avoid double counting equal elements (consistent tie-breaking).</li>
<li>Use modulo at every step to keep numbers within 64-bit and prevent overflows.</li>
<li>Work with 1-based arrays for simpler prefix indexing.</li>
<li>The formula is delicate; if you implement indices incorrectly you'll get wrong results. The provided code follows the standard correct pattern.</li>
</ul></div>

      <!-- Footer -->
      <footer>
        <p><strong>Part of DSA Questions Collection</strong></p>
        <p>
          <a href="index.html">Browse All Questions</a> ‚Ä¢
          <a
            href="https://github.com/pranavlonari/dsa-questions"
            target="_blank"
            >GitHub</a
          >
          ‚Ä¢
          <a href="#" onclick="window.print(); return false;">Print</a>
        </p>
        <p style="margin-top: 10px; font-size: 0.9em">
          üí° Interview-ready solutions with detailed explanations
        </p>
      </footer>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
      <span>‚úì</span>
      <span id="toastMessage">Copied to clipboard!</span>
    </div>

    <script>
      // Question data from questions.json
      let questionsData = [];
      let currentQuestionIndex = -1;

      // Load questions data
      async function loadQuestionsData() {
        try {
          const response = await fetch("questions.json");
          questionsData = (await response.json()).questions;
          initializeNavigation();
        } catch (error) {
          console.error("Error loading questions:", error);
        }
      }

      // Initialize navigation
      function initializeNavigation() {
        const currentFileName = getCurrentFileName();
        console.log("Current file:", currentFileName);
        console.log("Questions data:", questionsData);

        currentQuestionIndex = questionsData.findIndex(
          (q) => q.fileName === currentFileName
        );

        console.log("Current index:", currentQuestionIndex);

        // Update prev/next buttons
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");

        if (currentQuestionIndex <= 0) {
          prevBtn.disabled = true;
          prevBtn.style.opacity = "0.5";
          prevBtn.style.cursor = "not-allowed";
        } else {
          prevBtn.disabled = false;
          prevBtn.style.opacity = "1";
          prevBtn.style.cursor = "pointer";
        }

        if (
          currentQuestionIndex >= questionsData.length - 1 ||
          currentQuestionIndex === -1
        ) {
          nextBtn.disabled = true;
          nextBtn.style.opacity = "0.5";
          nextBtn.style.cursor = "not-allowed";
        } else {
          nextBtn.disabled = false;
          nextBtn.style.opacity = "1";
          nextBtn.style.cursor = "pointer";
        }

        // Add code copy buttons
        addCopyButtonsToCode();
      }

      // Get current file name
      function getCurrentFileName() {
        const path = window.location.pathname;
        let fileName = decodeURIComponent(
          path.substring(path.lastIndexOf("/") + 1)
        );
        // Remove .html extension
        if (fileName.endsWith(".html")) {
          fileName = fileName.slice(0, -5);
        }
        return fileName || "Sum of Total Strength of Wizards";
      }

      // Navigate to previous question
      function navigateToPrev() {
        if (currentQuestionIndex > 0) {
          const prevQuestion = questionsData[currentQuestionIndex - 1];
          window.location.href =
            encodeURIComponent(prevQuestion.fileName) + ".html";
        }
      }

      // Navigate to next question
      function navigateToNext() {
        if (
          currentQuestionIndex < questionsData.length - 1 &&
          currentQuestionIndex !== -1
        ) {
          const nextQuestion = questionsData[currentQuestionIndex + 1];
          window.location.href =
            encodeURIComponent(nextQuestion.fileName) + ".html";
        }
      }

      // Show random question
      function showRandomQuestion() {
        if (questionsData.length > 0) {
          const randomIndex = Math.floor(Math.random() * questionsData.length);
          const randomQuestion = questionsData[randomIndex];
          window.location.href =
            encodeURIComponent(randomQuestion.fileName) + ".html";
        }
      }

      // Search functionality
      document.getElementById("searchInput")?.addEventListener("input", (e) => {
        const searchTerm = e.target.value.toLowerCase();
        if (searchTerm.length > 2) {
          const results = questionsData.filter(
            (q) =>
              q.title.toLowerCase().includes(searchTerm) ||
              q.topics.some((t) => t.toLowerCase().includes(searchTerm))
          );
          // Could show dropdown with results
          console.log("Search results:", results);
        }
      });

      // Copy all content
      function copyContent() {
        const content = document.getElementById("questionContent").innerText;
        copyToClipboard(content, "All content copied!");
      }

      // Copy only code blocks
      function copyCode() {
        const codeBlocks = document.querySelectorAll(
          "#questionContent pre code"
        );
        let allCode = "";
        codeBlocks.forEach((block, index) => {
          if (index > 0) allCode += "\n\n// ================\n\n";
          allCode += block.innerText;
        });

        if (allCode) {
          copyToClipboard(allCode, "Code copied!");
        } else {
          showToast("No code found!", "error");
        }
      }

      // Copy to clipboard helper
      function copyToClipboard(text, message) {
        navigator.clipboard
          .writeText(text)
          .then(() => {
            showToast(message);
          })
          .catch((err) => {
            console.error("Failed to copy:", err);
            showToast("Failed to copy!", "error");
          });
      }

      // Show toast notification
      function showToast(message, type = "success") {
        const toast = document.getElementById("toast");
        const toastMessage = document.getElementById("toastMessage");

        toastMessage.textContent = message;
        toast.style.background = type === "error" ? "#dc3545" : "#28a745";
        toast.classList.add("show");

        setTimeout(() => {
          toast.classList.remove("show");
        }, 3000);
      }

      // Export to PDF
      function exportToPDF() {
        showToast("Preparing PDF...", "success");
        setTimeout(() => {
          window.print();
        }, 500);
      }

      // Export to Markdown
      function exportToMarkdown() {
        const title = document.getElementById("questionTitle").innerText;
        const content = document.getElementById("questionContent").innerText;

        const markdown = `# ${title}\n\n${content}`;

        const blob = new Blob([markdown], { type: "text/markdown" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `${title}.md`;
        a.click();
        URL.revokeObjectURL(url);

        showToast("Markdown exported!");
      }

      // Share question
      function shareQuestion() {
        const title = document.getElementById("questionTitle").innerText;
        const url = window.location.href;

        if (navigator.share) {
          navigator
            .share({
              title: title,
              url: url,
            })
            .then(() => {
              showToast("Shared successfully!");
            })
            .catch(() => {
              copyToClipboard(url, "Link copied!");
            });
        } else {
          copyToClipboard(url, "Link copied!");
        }
      }

      // Add copy buttons to code blocks
      function addCopyButtonsToCode() {
        const codeBlocks = document.querySelectorAll("#questionContent pre");
        codeBlocks.forEach((block, index) => {
          const button = document.createElement("button");
          button.className = "copy-code-btn";
          button.innerHTML = "üìã Copy";
          button.onclick = function () {
            const code =
              block.querySelector("code")?.innerText || block.innerText;
            copyToClipboard(code, "Code copied!");
            button.innerHTML = "‚úì Copied";
            button.classList.add("copied");
            setTimeout(() => {
              button.innerHTML = "üìã Copy";
              button.classList.remove("copied");
            }, 2000);
          };
          block.style.position = "relative";
          block.appendChild(button);
        });
      }

      // Theme toggle (optional)
      function toggleTheme() {
        // Implement dark mode if desired
        showToast("Theme toggle coming soon!");
      }

      // Keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        // Alt + Left Arrow - Previous
        if (e.altKey && e.key === "ArrowLeft") {
          navigateToPrev();
        }
        // Alt + Right Arrow - Next
        if (e.altKey && e.key === "ArrowRight") {
          navigateToNext();
        }
        // Ctrl + K - Search
        if (e.ctrlKey && e.key === "k") {
          e.preventDefault();
          document.getElementById("searchInput").focus();
        }
      });

      // Initialize on page load
      loadQuestionsData();
    </script>
  </body>
</html>
